# UIBubbleItem.cs - å¯¹è¯æ°”æ³¡é¡¹

## ğŸ“„ æ–‡ä»¶ä¿¡æ¯

| å±æ€§ | å€¼ |
|------|------|
| æ–‡ä»¶è·¯å¾„ | `Assets/Scripts/Code/Game/UIGame/UIAuction/UIBubbleItem.cs` |
| å‘½åç©ºé—´ | `TaoTie` |
| åŸºç±» | `UIBaseView` |
| å®ç°æ¥å£ | `IOnCreate`, `IOnEnable<BubbleData>`, `IOnEnable<BubbleData,int,ETCancellationToken>`, `II18N` |

---

## ğŸ¯ ç±»è¯´æ˜

`UIBubbleItem` æ˜¯å¯¹è¯æ°”æ³¡é¡¹ç»„ä»¶ï¼Œç”¨äºåœ¨ç©å®¶å¤´é¡¶æ˜¾ç¤ºå¯¹è¯æ°”æ³¡ï¼ŒåŒ…å«å‰ç¼€æ–‡æœ¬ã€è¡¨æƒ…å›¾æ ‡ã€ä»·æ ¼æ˜¾ç¤ºç­‰å†…å®¹ï¼Œæ”¯æŒè‡ªåŠ¨æ¶ˆå¤±ã€‚

### æ ¸å¿ƒèŒè´£

- **æ°”æ³¡å±•ç¤º**: æ˜¾ç¤ºç©å®¶å¯¹è¯æ°”æ³¡ï¼ˆåŒ…å«å‰ç¼€ã€è¡¨æƒ…ã€ä»·æ ¼ï¼‰
- **åæ ‡è¿½è¸ª**: è·Ÿéš 3D ä¸–ç•Œåæ ‡å®šä½
- **è‡ªåŠ¨æ¶ˆå¤±**: æŒ‡å®šæ—¶é—´åè‡ªåŠ¨å…³é—­
- **å›½é™…åŒ–**: æ”¯æŒå¤šè¯­è¨€æ–‡æœ¬å›¾ç‰‡
- **ç«æ‹æ ‡è¯†**: æ”¯æŒæ˜¾ç¤ºæŠ¬ä»·æ°”æ³¡æ ·å¼

---

## ğŸ“‹ å­—æ®µè¯´æ˜

### æ•°æ®ç»“æ„

#### `BubbleData`
æ°”æ³¡æ•°æ®ç»“æ„ã€‚

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| `front` | `string` | å‰ç¼€æ–‡æœ¬ï¼ˆå¦‚"æˆ‘å‡º"ï¼‰ |
| `end` | `string` | åç¼€æ–‡æœ¬ï¼ˆå¦‚ä»·æ ¼ï¼‰ |
| `emoji` | `int` | è¡¨æƒ…ç´¢å¼•ï¼ˆ0-6ï¼‰ |
| `worldSpace` | `Vector3` | 3D ä¸–ç•Œåæ ‡ |
| `isPlayer` | `bool` | æ˜¯å¦æ˜¯å½“å‰ç©å®¶ |
| `anim` | `bool` | æ˜¯å¦æ’­æ”¾åŠ¨ç”» |
| `iconType` | `int` | å›¾æ ‡ç±»å‹ï¼ˆ1-3ï¼‰ |
| `raiseBubble` | `bool` | æ˜¯å¦æ˜¯æŠ¬ä»·æ°”æ³¡ |

### UI ç»„ä»¶å­—æ®µ

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| `Root` | `UIImage` | æ ¹å®¹å™¨ï¼ˆæ°”æ³¡æ¡†ï¼‰ |
| `Text` | `UIImage` | "æˆ‘çš„ä»·æ ¼"æ–‡æœ¬å›¾ç‰‡ï¼ˆå›½é™…åŒ–ï¼‰ |
| `Front` | `UITextmesh` | å‰ç¼€æ–‡æœ¬ |
| `Icon` | `UIImage[]` | ä»·æ ¼å›¾æ ‡æ•°ç»„ï¼ˆ3 ä¸ªï¼‰ |
| `Price` | `UIEmptyView` | ä»·æ ¼åŒºåŸŸå®¹å™¨ |
| `End` | `UITextmesh` | ä»·æ ¼æ–‡æœ¬ |
| `Animator` | `UIAnimator` | åŠ¨ç”»æ§åˆ¶å™¨ |
| `Emoji` | `UIImage[]` | è¡¨æƒ…å›¾æ ‡æ•°ç»„ï¼ˆ7 ä¸ªï¼‰ |

### å¸¸é‡

| å¸¸é‡å | ç±»å‹ | å€¼ | è¯´æ˜ |
|--------|------|-----|------|
| `PrefabPath` | `string` | `"UIGame/UIAuction/Prefabs/UIBubbleItem.prefab"` | é¢„åˆ¶ä½“è·¯å¾„ |

---

## ğŸ”§ æ–¹æ³•è¯´æ˜

### ç”Ÿå‘½å‘¨æœŸæ–¹æ³•

#### `OnCreate()`
ç»„ä»¶åˆ›å»ºæ—¶åˆå§‹åŒ–æ‰€æœ‰ UI å­ç»„ä»¶ã€‚

**ä¸»è¦åŠŸèƒ½:**
1. åˆå§‹åŒ–åŠ¨ç”»æ§åˆ¶å™¨
2. åˆå§‹åŒ–æ°”æ³¡æ¡†ã€æ–‡æœ¬ã€å‰ç¼€ç»„ä»¶
3. åˆå§‹åŒ– 3 ä¸ªä»·æ ¼å›¾æ ‡
4. åˆå§‹åŒ– 7 ä¸ªè¡¨æƒ…å›¾æ ‡
5. åˆå§‹åŒ–ä»·æ ¼åŒºåŸŸ

#### `OnEnable(BubbleData data)`
å¯ç”¨ç»„ä»¶å¹¶è®¾ç½®æ•°æ®ï¼ˆé»˜è®¤ 1500ms åæ¶ˆå¤±ï¼‰ã€‚

#### `OnEnable(BubbleData data, int time, ETCancellationToken cancel)`
å¯ç”¨ç»„ä»¶å¹¶è®¾ç½®æ•°æ®å’Œæ¶ˆå¤±æ—¶é—´ã€‚

**å‚æ•°è¯´æ˜:**
- `data`: æ°”æ³¡æ•°æ®
- `time`: æ˜¾ç¤ºæ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰
- `cancel`: å–æ¶ˆä»¤ç‰Œ

#### `OnLanguageChange()`
è¯­è¨€åˆ‡æ¢æ—¶æ›´æ–°å›½é™…åŒ–æ–‡æœ¬å›¾ç‰‡ã€‚

---

### ä¸šåŠ¡æ–¹æ³•

#### `SetData(...)`
è®¾ç½®æ°”æ³¡æ•°æ®å¹¶åˆ·æ–°æ˜¾ç¤ºã€‚

**å‚æ•°è¯´æ˜:**
- `front`: å‰ç¼€æ–‡æœ¬
- `end`: ä»·æ ¼æ–‡æœ¬
- `emoji`: è¡¨æƒ…ç´¢å¼•
- `worldSpace`: 3D ä¸–ç•Œåæ ‡
- `isPlayer`: æ˜¯å¦æ˜¯å½“å‰ç©å®¶
- `anim`: æ˜¯å¦æ’­æ”¾åŠ¨ç”»
- `iconType`: å›¾æ ‡ç±»å‹ï¼ˆ1-3ï¼‰
- `raiseBubble`: æ˜¯å¦æ˜¯æŠ¬ä»·æ°”æ³¡

**ä¸»è¦åŠŸèƒ½:**
1. **æ°”æ³¡æ ·å¼**: æ ¹æ® `raiseBubble` è®¾ç½®ä¸åŒçš„æ°”æ³¡æ¡†
2. **åŠ¨ç”»æ§åˆ¶**: è®¾ç½®æ˜¯å¦å¯ç”¨åŠ¨ç”»
3. **æ–‡æœ¬æ˜¾ç¤º**: æ ¹æ® `isPlayer` æ˜¾ç¤º/éšè—"æˆ‘çš„ä»·æ ¼"æ–‡æœ¬
4. **è¡¨æƒ…æ˜¾ç¤º**: æ ¹æ®ç´¢å¼•æ¿€æ´»å¯¹åº”è¡¨æƒ…
5. **å‰ç¼€æ˜¾ç¤º**: è®¾ç½®å¹¶æ˜¾ç¤º/éšè—å‰ç¼€æ–‡æœ¬
6. **ä»·æ ¼æ˜¾ç¤º**: æ ¹æ® `iconType` æ˜¾ç¤ºå¯¹åº”å›¾æ ‡å’Œä»·æ ¼
7. **åæ ‡å®šä½**:
   - å°† 3D ä¸–ç•Œåæ ‡è½¬æ¢ä¸º UI åæ ‡
   - æ ¹æ® X åæ ‡è°ƒæ•´æ°´å¹³ç¿»è½¬ï¼ˆé•œåƒï¼‰
   - åŒæ­¥ç¼©æ”¾æ‰€æœ‰å­ç»„ä»¶

---

## ğŸ”„ æµç¨‹å›¾

```mermaid
flowchart TD
    A[OnEnable è°ƒç”¨] --> B[SetData è®¾ç½®æ•°æ®]
    B --> C[è®¾ç½®æ°”æ³¡æ¡†æ ·å¼]
    C --> D{æ˜¯å½“å‰ç©å®¶ï¼Ÿ}
    D -->|æ˜¯ | E[æ˜¾ç¤º"æˆ‘çš„ä»·æ ¼"æ–‡æœ¬]
    D -->|å¦ | F[éšè—æ–‡æœ¬]
    
    E --> G[è®¾ç½®è¡¨æƒ…]
    F --> G
    
    G --> H{å‰ç¼€éç©ºï¼Ÿ}
    H -->|æ˜¯ | I[æ˜¾ç¤ºå‰ç¼€]
    H -->|å¦ | J[éšè—å‰ç¼€]
    
    I --> K{ä»·æ ¼éç©ºï¼Ÿ}
    J --> K
    
    K -->|æ˜¯ | L[æ˜¾ç¤ºä»·æ ¼åŒºåŸŸ]
    K -->|å¦ | M[éšè—ä»·æ ¼åŒºåŸŸ]
    
    L --> N[åæ ‡è½¬æ¢]
    M --> N
    
    N --> O{X >= -1?}
    O -->|æ˜¯ | P[æ­£å¸¸ç¼©æ”¾]
    O -->|å¦ | Q[æ°´å¹³ç¿»è½¬]
    
    P --> R[å¯åŠ¨å®šæ—¶å™¨]
    Q --> R
    
    R --> S[ç­‰å¾… time æ¯«ç§’]
    S --> T[å…³é—­ç»„ä»¶]
```

---

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### æ˜¾ç¤ºç©å®¶å¯¹è¯æ°”æ³¡

```csharp
// åˆ›å»ºæ°”æ³¡æ•°æ®
var data = new UIBubbleItem.BubbleData
{
    front = "æˆ‘å‡º",
    end = "1000",
    emoji = 2,  // ç¬‘è„¸
    worldSpace = playerEntity.Position,
    isPlayer = true,
    anim = true,
    iconType = 1,
    raiseBubble = false
};

// æ‰“å¼€æ°”æ³¡ï¼ˆé»˜è®¤ 1500msï¼‰
UIManager.Instance.OpenWindow<UIBubbleItem, UIBubbleItem.BubbleData>(
    UIBubbleItem.PrefabPath,
    data
);

// æ‰“å¼€æ°”æ³¡ï¼ˆæŒ‡å®šæ—¶é•¿ï¼‰
UIManager.Instance.OpenWindow<UIBubbleItem, UIBubbleItem.BubbleData, int, ETCancellationToken>(
    UIBubbleItem.PrefabPath,
    data,
    3000,  // 3 ç§’
    cancellationToken
);
```

### æŠ¬ä»·æ°”æ³¡

```csharp
// æŠ¬ä»·æ—¶ä½¿ç”¨ç‰¹æ®Šæ ·å¼
var raiseData = new UIBubbleItem.BubbleData
{
    front = "",
    end = "2000",
    emoji = 5,  // å¾—æ„è¡¨æƒ…
    worldSpace = playerEntity.Position,
    isPlayer = false,
    anim = true,
    iconType = 2,
    raiseBubble = true  // æŠ¬ä»·æ ·å¼
};
```

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [UIEmojiItem.cs.md](./UIEmojiItem.cs.md) - è¡¨æƒ…é¡¹ç»„ä»¶
- [CameraManager.cs.md](../../../Manager/CameraManager.cs.md) - ç›¸æœºç®¡ç†å™¨
- [UIManager.cs.md](../../../UI/UIManager.cs.md) - UI ç®¡ç†å™¨

---

*æœ€åæ›´æ–°ï¼š2026-03-02*
