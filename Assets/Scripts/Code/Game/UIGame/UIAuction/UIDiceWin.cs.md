# UIDiceWin.cs - éª°å­é€‰æ‹©çª—å£

## ğŸ“„ æ–‡ä»¶ä¿¡æ¯

| å±æ€§ | å€¼ |
|------|------|
| æ–‡ä»¶è·¯å¾„ | `Assets/Scripts/Code/Game/UIGame/UIAuction/UIDiceWin.cs` |
| å‘½åç©ºé—´ | `TaoTie` |
| åŸºç±» | `UIBaseView` |
| å®ç°æ¥å£ | `IOnCreate`, `IOnEnable`, `IOnDisable` |

---

## ğŸ¯ ç±»è¯´æ˜

`UIDiceWin` æ˜¯éª°å­é€‰æ‹©çª—å£ï¼Œç©å®¶å¯ä»¥åœ¨è¿™é‡ŒæŸ¥çœ‹å½“å‰éª°å­æ•ˆæœã€éšæœºé€‰æ‹©æ–°éª°å­ï¼Œæˆ–é€šè¿‡è§‚çœ‹å¹¿å‘Šè·å–å…è´¹éª°å­ã€‚

### æ ¸å¿ƒèŒè´£

- **éª°å­å±•ç¤º**: æ˜¾ç¤ºå½“å‰éª°å­çš„å›¾æ ‡ã€åç§°å’Œæ•ˆæœæè¿°
- **éšæœºé€‰æ‹©**: æ ¹æ®æƒé‡éšæœºé€‰æ‹©æ–°çš„éª°å­
- **å¹¿å‘Šè·å–**: æ”¯æŒé€šè¿‡è§‚çœ‹å¹¿å‘Šè·å–å…è´¹éª°å­
- **è®¾ç½®è®°å¿†**: è®°å¿†ç©å®¶æ˜¯å¦å¯ç”¨éª°å­é€‰æ‹©æç¤º
- **çŠ¶æ€ç®¡ç†**: æ ¹æ®æ¸¸æˆé˜¶æ®µæ˜¾ç¤ºä¸åŒçš„æ“ä½œæŒ‰é’®

---

## ğŸ“‹ å­—æ®µè¯´æ˜

### UI ç»„ä»¶å­—æ®µ

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| `Mask` | `UIPointerClick` | é®ç½©å±‚ï¼ˆç‚¹å‡»å…³é—­ï¼‰ |
| `Title` | `UITextmesh` | éª°å­åç§°æ ‡é¢˜ |
| `Icon` | `UIImage` | éª°å­å›¾æ ‡ |
| `Text1` | `UITextmesh` | æŒ‰é’® 1 æ–‡æœ¬ |
| `CommonToggle` | `UIToggle` | é€šç”¨è®¾ç½®å¼€å…³ |
| `Button1` | `UIButton` | æŒ‰é’® 1ï¼ˆä½¿ç”¨/é‡é€‰ï¼‰ |
| `Text2` | `UITextmesh` | æŒ‰é’® 2 æ–‡æœ¬ |
| `Ad1` | `UIImage` | å¹¿å‘Šæ ‡è¯†å›¾ç‰‡ |
| `Button2` | `UIButton` | æŒ‰é’® 2ï¼ˆç¡®è®¤/è¿”å›ï¼‰ |
| `Text` | `UITextmesh` | éª°å­æ•ˆæœæè¿° |
| `Using` | `UITextmesh` | "ä½¿ç”¨ä¸­"æç¤ºæ–‡æœ¬ |
| `UICommonWin` | `UIAnimator` | é€šç”¨çª—å£åŠ¨ç”»æ§åˆ¶å™¨ |

### é…ç½®å­—æ®µ

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| `DiceAdGetCount` | `int` | è§‚çœ‹å¹¿å‘Šè·å¾—çš„éª°å­æ•°é‡ï¼ˆé»˜è®¤ 3ï¼‰ |
| `configId` | `int` | å½“å‰é€‰ä¸­çš„éª°å­é…ç½® ID |

---

## ğŸ”§ æ–¹æ³•è¯´æ˜

### ç”Ÿå‘½å‘¨æœŸæ–¹æ³•

#### `OnCreate()`
çª—å£åˆ›å»ºæ—¶åˆå§‹åŒ–æ‰€æœ‰ UI ç»„ä»¶ã€‚

**ä¸»è¦åŠŸèƒ½:**
1. è¯»å–å¹¿å‘Šè·å–éª°å­æ•°é‡é…ç½®
2. åˆå§‹åŒ–æ‰€æœ‰ UI ç»„ä»¶å¼•ç”¨
3. ä¸ºæŒ‰é’® 1 æ·»åŠ éª°å­æ•°é‡çº¢ç‚¹ç»„ä»¶

#### `OnEnable()`
çª—å£å¯ç”¨æ—¶åˆ·æ–°çŠ¶æ€å¹¶ç»‘å®šäº‹ä»¶ã€‚

**ä¸»è¦åŠŸèƒ½:**
1. æ’­æ”¾æ‰“å¼€éŸ³æ•ˆ
2. è·å–å½“å‰éª°å­ ID
3. åˆ·æ–°éª°å­æ˜¾ç¤º
4. ç»‘å®šå¼€å…³å’ŒæŒ‰é’®äº‹ä»¶
5. è¯»å–å¹¶åº”ç”¨ç©å®¶çš„è®¾ç½®åå¥½

#### `OnDisable()`
çª—å£ç¦ç”¨æ—¶æ¢å¤æ¸¸æˆæ—¶é—´æµé€Ÿã€‚

**ä¸»è¦åŠŸèƒ½:**
1. æ£€æŸ¥æ˜¯å¦éœ€è¦æ¢å¤æ—¶é—´æµé€Ÿ
2. é€šçŸ¥ UIGameView çª—å£å·²å…³é—­

#### `CloseSelf()`
å…³é—­çª—å£æ—¶æ’­æ”¾å…³é—­åŠ¨ç”»å’ŒéŸ³æ•ˆã€‚

---

### ä¸šåŠ¡æ–¹æ³•

#### `RefreshDice()`
åˆ·æ–°éª°å­æ˜¾ç¤ºä¿¡æ¯ã€‚

**ä¸»è¦åŠŸèƒ½:**
1. ä»é…ç½®è¡¨è·å–éª°å­æ•°æ®
2. è®¾ç½®æ•ˆæœæè¿°æ–‡æœ¬
3. è®¾ç½®æ ‡é¢˜æ–‡æœ¬
4. åŠ è½½éª°å­å›¾æ ‡

#### `RefreshBtn()`
æ ¹æ®æ¸¸æˆçŠ¶æ€åˆ·æ–°æŒ‰é’®æ˜¾ç¤ºå’Œæ–‡æœ¬ã€‚

**çŠ¶æ€é€»è¾‘:**
- **æœªé€‰æ‹©éª°å­ (DiceId == 0)**:
  - æ˜¾ç¤º"ä½¿ç”¨"å’Œ"è¿”å›"æŒ‰é’®
  - å¦‚æœéª°å­ä¸è¶³ä¸”æ”¯æŒå¹¿å‘Šï¼Œæ˜¾ç¤º"è§‚çœ‹å¹¿å‘Šè·å–"
- **å·²é€‰æ‹©ä½†æœªç¡®è®¤**:
  - æ˜¾ç¤º"é‡é€‰"å’Œ"ç¡®è®¤"æŒ‰é’®
- **å·²ç¡®è®¤ä½¿ç”¨**:
  - æ˜¾ç¤º"ä½¿ç”¨ä¸­"æç¤º
  - éšè—æ“ä½œæŒ‰é’®

#### `RandomDice()`
æ ¹æ®æƒé‡éšæœºé€‰æ‹©æ–°éª°å­ã€‚

**ç®—æ³•æµç¨‹:**
1. è·å–å½“å‰ç­‰çº§çš„éª°å­é…ç½®åˆ—è¡¨
2. è®¡ç®—æ€»æƒé‡
3. ç”Ÿæˆéšæœºæ•°
4. æ ¹æ®æƒé‡åˆ†å¸ƒé€‰æ‹©éª°å­
5. æ¶ˆè€—ä¸€ä¸ªéª°å­é“å…·
6. åˆ·æ–°æ˜¾ç¤º

#### `AdGetDice()`
é€šè¿‡è§‚çœ‹å¹¿å‘Šè·å–å…è´¹éª°å­ã€‚

**æµç¨‹:**
1. ç¦ç”¨æŒ‰é’®é˜²æ­¢é‡å¤ç‚¹å‡»
2. æ’­æ”¾å¹¿å‘Š
3. å¹¿å‘ŠæˆåŠŸåå¢åŠ éª°å­é“å…·
4. åˆ·æ–°æŒ‰é’®çŠ¶æ€
5. æ¢å¤æŒ‰é’®äº¤äº’

---

### äº‹ä»¶å¤„ç†æ–¹æ³•

#### `OnClickMask()`
ç‚¹å‡»é®ç½©å±‚å…³é—­çª—å£ã€‚

#### `SetOnCommonToggleValueChanged(bool val)`
è®¾ç½®å¼€å…³çŠ¶æ€å˜åŒ–æ—¶ä¿å­˜åˆ°ç¼“å­˜ã€‚

**å‚æ•°è¯´æ˜:**
- `val`: å¼€å…³çŠ¶æ€ï¼ˆtrue=å¯ç”¨æç¤ºï¼‰

#### `OnClickUseDice()`
ä½¿ç”¨éª°å­æˆ–è·å–éª°å­ã€‚

**é€»è¾‘:**
- å¦‚æœéª°å­æ•°é‡ > 0ï¼šéšæœºé€‰æ‹©æ–°éª°å­
- å¦‚æœéª°å­ä¸è¶³ä¸”æ”¯æŒå¹¿å‘Šï¼šæ’­æ”¾å¹¿å‘Šè·å–
- å¦åˆ™ï¼šæ˜¾ç¤ºæç¤º"é“å…·ä¸è¶³"

#### `OnClickApplyDice()`
ç¡®è®¤ä½¿ç”¨å½“å‰é€‰æ‹©çš„éª°å­ã€‚

**æµç¨‹:**
1. ç¦ç”¨æŒ‰é’®
2. ç¦ç”¨é®ç½©ç‚¹å‡»
3. è°ƒç”¨æ‹å–ç®¡ç†å™¨çš„ SelectDice æ–¹æ³•
4. ä¼ å…¥å…³é—­å›è°ƒ

---

## ğŸ”„ æµç¨‹å›¾

```mermaid
flowchart TD
    A[æ‰“å¼€ UIDiceWin] --> B{å½“å‰ DiceId == 0?}
    B -->|æ˜¯ | C{ç©å®¶æœ‰éª°å­é“å…·ï¼Ÿ}
    B -->|å¦ | D[æ˜¾ç¤º"ä½¿ç”¨ä¸­"]
    
    C -->|æ˜¯ | E[æ˜¾ç¤º"ä½¿ç”¨"æŒ‰é’®]
    C -->|å¦ | F{å¹³å°æ”¯æŒå¹¿å‘Šï¼Ÿ}
    
    F -->|æ˜¯ | G[æ˜¾ç¤º"è§‚çœ‹å¹¿å‘Šè·å–"]
    F -->|å¦ | H[æ˜¾ç¤º"é“å…·ä¸è¶³"æç¤º]
    
    E --> I[ç‚¹å‡»ä½¿ç”¨]
    I --> J[RandomDice éšæœºé€‰æ‹©]
    J --> K[åˆ·æ–°æ˜¾ç¤º]
    K --> L[æ˜¾ç¤º"é‡é€‰"+"ç¡®è®¤"]
    
    G --> M[æ’­æ”¾å¹¿å‘Š]
    M --> N{å¹¿å‘ŠæˆåŠŸï¼Ÿ}
    N -->|æ˜¯ | O[å¢åŠ éª°å­é“å…·]
    N -->|å¦ | P[æ¢å¤æŒ‰é’®]
    O --> E
    
    L --> Q{ç‚¹å‡»ç¡®è®¤ï¼Ÿ}
    Q -->|æ˜¯ | R[è°ƒç”¨ SelectDice]
    Q -->|æ˜¯ | S[å…³é—­çª—å£]
```

---

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### æ‰“å¼€éª°å­é€‰æ‹©çª—å£

```csharp
// ä» UIGameView æˆ–å…¶ä»–ç•Œé¢æ‰“å¼€
UIManager.Instance.OpenWindow<UIDiceWin>(UIDiceWin.PrefabPath);

// çª—å£ä¼šè‡ªåŠ¨ï¼š
// 1. è·å–å½“å‰éª°å­ ID (IAuctionManager.Instance.DiceId)
// 2. æ˜¾ç¤ºå¯¹åº”éª°å­ä¿¡æ¯
// 3. æ ¹æ®çŠ¶æ€æ˜¾ç¤ºåˆé€‚çš„æŒ‰é’®
```

### éª°å­é…ç½®è¡¨ç¤ºä¾‹

```csharp
// DiceConfigCategory é…ç½®ç»“æ„
{
    Id: 1,
    Name: "å¹¸è¿éª°å­",
    Icon: "UIGame/UIAuction/Dice/dice_1.png",
    Text: "ä½¿ä¸‹ä¸€æ¬¡ç«æ‹ä»·æ ¼ +10%",
    Weight: 30  // æƒé‡ï¼Œç”¨äºéšæœºé€‰æ‹©
}
```

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [UIGameView.cs.md](./UIGameView.cs.md) - æ¸¸æˆä¸»ç•Œé¢
- [AuctionManager.cs.md](../../../System/Auction/AuctionManager.cs.md) - æ‹å–ç®¡ç†å™¨
- [DiceConfigCategory.cs.md](../../../../Module/Generate/Config/DiceConfig.cs.md) - éª°å­é…ç½®è¡¨
- [PlayerDataManager.cs.md](../../../Data/PlayerDataManager.cs.md) - ç©å®¶æ•°æ®ç®¡ç†

---

*æœ€åæ›´æ–°ï¼š2026-03-02*
