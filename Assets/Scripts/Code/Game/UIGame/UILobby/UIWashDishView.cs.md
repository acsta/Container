# UIWashDishView.cs - é¤å…æ´—ç¢—ç•Œé¢

## ğŸ“„ æ–‡ä»¶ä¿¡æ¯

| å±æ€§ | å€¼ |
|------|------|
| æ–‡ä»¶è·¯å¾„ | `Assets/Scripts/Code/Game/UIGame/UILobby/UIWashDishView.cs` |
| å‘½åç©ºé—´ | `TaoTie` |
| åŸºç±» | `UIBaseView` |
| å®ç°æ¥å£ | `IOnCreate`, `IOnEnable` |

---

## ğŸ¯ ç±»è¯´æ˜

`UIWashDishView` æ˜¯é¤å…æ´—ç¢—å°æ¸¸æˆç•Œé¢ï¼Œç©å®¶é€šè¿‡ç‚¹å‡»ç›˜å­è¿›è¡Œæ´—ç¢—æ“ä½œè·å¾—æ”¶ç›Šã€‚ç•Œé¢æ”¯æŒæ‰‹åŠ¨æ´—ç¢—ã€è‡ªåŠ¨æ´—ç¢—ï¼ˆè§£é”åï¼‰ã€çœ‹å¹¿å‘ŠåŠ é€Ÿã€é¤å…å‡çº§ç­‰åŠŸèƒ½ã€‚

### æ ¸å¿ƒèŒè´£

- **æ´—ç¢—æ“ä½œ**: ç‚¹å‡»ç›˜å­è¿›è¡Œæ´—ç¢—ï¼Œæ’­æ”¾åŠ¨ç”»æ•ˆæœ
- **æ”¶ç›Šå±•ç¤º**: å®æ—¶æ˜¾ç¤ºé¤å…ç´¯è®¡æ”¶ç›Šå’Œæ”¶ç›Šè¿›åº¦
- **è‡ªåŠ¨æ´—ç¢—**: æ”¯æŒè§£é”è‡ªåŠ¨æ´—ç¢—åŠŸèƒ½ï¼ˆç¦»çº¿æ”¶ç›Šï¼‰
- **å¹¿å‘ŠåŠ é€Ÿ**: çœ‹å¹¿å‘Šå¿«é€Ÿæ·»åŠ ç›˜å­
- **é¤å…å‡çº§**: æ”¯æŒå‡çº§é¤å…ç­‰çº§æå‡æ”¶ç›Š

---

## ğŸ“‹ å­—æ®µè¯´æ˜

### UI ç»„ä»¶å­—æ®µ

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| `UICommonView` | `UIAnimator` | é€šç”¨è§†å›¾åŠ¨ç”»æ§åˆ¶å™¨ |
| `Talk` | `UITextmesh` | å¯¹è¯æ–‡æœ¬ |
| `Dishes` | `UICopyGameObject` | ç›˜å­åˆ—è¡¨å®¹å™¨ |
| `Close` | `UIButton` | å…³é—­æŒ‰é’® |
| `Wash` | `UIEmptyView` | æ´—ç¢—åŠ¨ç”»åŒºåŸŸ |
| `BtnAdd` | `UIButton` | çœ‹å¹¿å‘ŠåŠ ç›˜å­æŒ‰é’® |
| `BtnAddText` | `UITextmesh` | åŠ ç›˜å­æŒ‰é’®æ–‡æœ¬ |
| `BtnAuto` | `UIButton` | è‡ªåŠ¨æ´—ç¢—è§£é”æŒ‰é’® |
| `TextLv` | `UITextmesh` | é¤å…ç­‰çº§æ–‡æœ¬ |
| `Cost` | `UITextmesh` | å‡çº§æ¶ˆè€—æ–‡æœ¬ |
| `LevelUp` | `UIEmptyView` | å‡çº§æŒ‰é’®åŒºåŸŸ |
| `LevelMax` | `UIEmptyView` | å·²è¾¾æ»¡çº§åŒºåŸŸ |
| `From` / `To` | `UITextmesh` | å‡çº§å‰åæ”¶ç›Šå¯¹æ¯” |
| `BtnLevelUp` | `UIButton` | å‡çº§æŒ‰é’® |
| `PointerDish` | `UIPointerClick` | ç›˜å­ç‚¹å‡»åŒºåŸŸ |
| `Bubble` | `ParticleSystem` | æ³¡æ³¡ç²’å­ç‰¹æ•ˆ |
| `MoneyGroup` | `UIEmptyView` | è‡ªåŠ¨æ”¶ç›ŠåŒºåŸŸ |
| `Effect` | `UIEmptyView` | æ”¶ç›Šç‰¹æ•ˆ |
| `GetButton` | `UIButton` | æ”¶ç›ŠæŒ‰é’® |
| `Slider` | `UISlider` | æ”¶ç›Šè¿›åº¦æ¡ |
| `ValueText` | `UITextmesh` | æ”¶ç›Šæ•°å€¼æ–‡æœ¬ |
| `Speed` | `UITextmesh` | æ”¶ç›Šé€Ÿåº¦æ–‡æœ¬ |
| `Mask` | `UIEmptyView` | è¿›åº¦æ¡é®ç½© |
| `SliderAnim` | `UIAnimator` | è¿›åº¦æ¡åŠ¨ç”» |
| `Fill` | `UIImage` | è¿›åº¦æ¡å¡«å…… |

### å¸¸é‡å®šä¹‰

| å¸¸é‡å | ç±»å‹ | å€¼ | è¯´æ˜ |
|--------|------|------|------|
| `DISH_COUNT` | `int` | `6` | æœ€å¤§ç›˜å­æ•°é‡ |
| `DURING` | `int` | `100` | æ´—ç¢—åŠ¨ç”»é—´éš” |
| `DishAdd` | `static int` | `10` | å¹¿å‘Šæ·»åŠ ç›˜å­æ•°é‡ |
| `DishAddDuring` | `static int` | - | å¹¿å‘Šæ·»åŠ å†·å´æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ |

### æ•°æ®å­—æ®µ

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| `timerId` | `long` | è‡ªåŠ¨æ”¶ç›Šæ›´æ–°å®šæ—¶å™¨ ID |
| `timerId2` | `long` | å¹¿å‘Šå†·å´å€’è®¡æ—¶å®šæ—¶å™¨ ID |
| `step` | `int` | æ´—ç¢—æ­¥éª¤è®¡æ•° |
| `isAnim` | `bool` | æ˜¯å¦æ­£åœ¨æ’­æ”¾åŠ¨ç”» |
| `index` | `int` | å½“å‰æ“ä½œçš„ç›˜å­ç´¢å¼• |

### å†…éƒ¨ç±»

#### `UIRestaurantViewUpdateTimer`
é¤å…æ”¶ç›Šæ›´æ–°å®šæ—¶å™¨ï¼ŒæŒ‰å›ºå®šé—´éš”æ›´æ–°æ”¶ç›Šè¿›åº¦ã€‚

```csharp
[Timer(TimerType.UIRestaurantViewUpdate)]
public class UIRestaurantViewUpdateTimer : ATimer<UIWashDishView>
{
    public override void Run(UIWashDishView self)
    {
        try
        {
            self.Update();
        }
        catch (Exception e)
        {
            Log.Error($"move timer error: UIRestaurantView\n{e}");
        }
    }
}
```

#### `UIWashDishViewUpdateTimer`
å¹¿å‘Šå†·å´å€’è®¡æ—¶å®šæ—¶å™¨ï¼Œæ¯ç§’æ›´æ–°æŒ‰é’®æ–‡æœ¬ã€‚

---

## ğŸ”§ æ–¹æ³•è¯´æ˜

### ç”Ÿå‘½å‘¨æœŸæ–¹æ³•

#### `OnCreate()`
åˆå§‹åŒ–ç•Œé¢ UI ç»„ä»¶å’Œäº‹ä»¶ç»‘å®šã€‚

**ä¸»è¦åŠŸèƒ½:**
1. åˆå§‹åŒ–æ‰€æœ‰ UI ç»„ä»¶
2. åˆå§‹åŒ–ç›˜å­åˆ—è¡¨ï¼ˆ6 ä¸ªä½ç½®ï¼‰
3. ç»‘å®šæ‰€æœ‰æŒ‰é’®ç‚¹å‡»äº‹ä»¶
4. æ³¨å†Œçº¢ç‚¹ç»„ä»¶
5. è®¾ç½®å›½é™…åŒ–æ–‡æœ¬

#### `OnEnable()`
ç•Œé¢å¯ç”¨æ—¶åˆå§‹åŒ–æ•°æ®å’Œå®šæ—¶å™¨ã€‚

**å¤„ç†æµç¨‹:**
1. æ£€æŸ¥é¤å…ç­‰çº§ï¼Œä¸º 0 æ—¶è‡ªåŠ¨å‡çº§
2. åœæ­¢æ³¡æ³¡ç²’å­
3. åŠ è½½å…¨å±€é…ç½®ï¼ˆç›˜å­æ•°é‡ã€å†·å´æ—¶é—´ï¼‰
4. åˆ·æ–°é¤å…æ”¶ç›Šçº¢ç‚¹
5. é‡ç½®åŠ¨ç”»çŠ¶æ€
6. åˆ·æ–°ç›˜å­åˆ—è¡¨
7. æ’­æ”¾æ‰“å¼€éŸ³æ•ˆ
8. ç»‘å®šæ‰€æœ‰äº‹ä»¶
9. åˆ·æ–°ç­‰çº§ä¿¡æ¯
10. æ ¹æ®è‡ªåŠ¨æ´—ç¢—çŠ¶æ€è®¾ç½®å®šæ—¶å™¨
11. ç«‹å³æ›´æ–°æ”¶ç›Šæ˜¾ç¤º

#### `OnEnableAsync()`
å¼‚æ­¥æ’­æ”¾ç•Œé¢æ‰“å¼€åŠ¨ç”»ã€‚

**è¿”å›:** `ETTask`

#### `CloseSelf()`
å…³é—­ç•Œé¢ï¼Œæ¸…ç†å®šæ—¶å™¨å¹¶è¿”å›å¤§å…ã€‚

**è¿”å›:** `ETTask`

---

### ä¸šåŠ¡æ–¹æ³•

#### `Update()`
æ¯å¸§æ›´æ–°æ”¶ç›Šè¿›åº¦æ¡å’ŒçŠ¶æ€ã€‚

**å¤„ç†æµç¨‹:**
1. è®¡ç®—æœ€å¤§æ”¶ç›Šå’Œå½“å‰æ”¶ç›Š
2. æ ¹æ®æ”¶ç›Šæ¯”ä¾‹åˆ‡æ¢é‡‘å¸å›¾æ ‡
3. æ›´æ–°è¿›åº¦æ¡
4. æ¿€æ´»/å¤±æ´»é€Ÿåº¦ç‰¹æ•ˆ
5. æ¿€æ´»è¿›åº¦æ¡æ»¡ç‰¹æ•ˆ
6. æ›´æ–°æ”¶ç›Šæ–‡æœ¬
7. åˆ·æ–°æ”¶ç›Šçª—å£ï¼ˆå¦‚æœæ‰“å¼€ï¼‰
8. æ¿€æ´»æ”¶ç›Šç‰¹æ•ˆï¼ˆå¦‚æœæ˜¯é¡¶å±‚çª—å£ï¼‰
9. åˆ·æ–°é¤å…æ”¶ç›Šçº¢ç‚¹

#### `UpdateAdd()`
æ¯ç§’æ›´æ–°å¹¿å‘ŠåŠ ç›˜å­çš„å†·å´å€’è®¡æ—¶ã€‚

**å¤„ç†æµç¨‹:**
1. è®¡ç®—è·ç¦»å†·å´ç»“æŸçš„æ—¶é—´
2. å†·å´ä¸­æ˜¾ç¤ºå€’è®¡æ—¶
3. å†·å´å®Œæˆæ˜¾ç¤º"ç‚¹å‡»åŠ  N ä¸ªç›˜å­"

#### `UpdateImmediate()`
ç«‹å³æ›´æ–°æ”¶ç›Šæ˜¾ç¤ºï¼ˆä¸ç­‰å¾…å®šæ—¶å™¨ï¼‰ã€‚

#### `WashDish(int index)`
æ’­æ”¾æ´—ç¢—åŠ¨ç”»ã€‚

**å‚æ•°è¯´æ˜:**
- `index`: ç›˜å­ç´¢å¼•

**è¿”å›:** `ETTask`

#### `RemoveDish(int index)`
æ’­æ”¾ç§»é™¤ç›˜å­åŠ¨ç”»ã€‚

**å‚æ•°è¯´æ˜:**
- `index`: ç›˜å­ç´¢å¼•

**è¿”å›:** `ETTask`

#### `RefreshLvInfo()`
åˆ·æ–°é¤å…ç­‰çº§ä¿¡æ¯ã€‚

**å¤„ç†æµç¨‹:**
1. è·å–å½“å‰å’Œä¸‹ä¸€çº§é¤å…é…ç½®
2. è®¾ç½®å‡çº§æŒ‰é’®æ˜¾ç¤ºçŠ¶æ€
3. è®¾ç½®ç­‰çº§æ–‡æœ¬
4. è®¾ç½®æ”¶ç›Šé€Ÿåº¦
5. è®¾ç½®å‡çº§å‰åæ”¶ç›Šå¯¹æ¯”
6. è®¾ç½®å‡çº§æ¶ˆè€—

---

### äº‹ä»¶å¤„ç†æ–¹æ³•

| æ–¹æ³•å | è§¦å‘æ¡ä»¶ | åŠŸèƒ½è¯´æ˜ |
|--------|----------|----------|
| `OnClickDish()` | ç‚¹å‡»ç›˜å­åŒºåŸŸ | æ‰§è¡Œæ´—ç¢—æˆ–ç§»é™¤ç›˜å­æ“ä½œ |
| `OnClickAdd()` | ç‚¹å‡»åŠ ç›˜å­æŒ‰é’® | æ£€æŸ¥å†·å´åæ’­æ”¾å¹¿å‘Š |
| `OnClickAddAsync()` | å¹¿å‘ŠæˆåŠŸå | é‡ç½®å†·å´æ—¶é—´å¹¶å¯åŠ¨å€’è®¡æ—¶ |
| `OnClickGetButton()` | ç‚¹å‡»æ”¶ç›ŠæŒ‰é’® | æ‰“å¼€æ”¶ç›Šçª—å£ |
| `OnClickClose()` | ç‚¹å‡»å…³é—­æŒ‰é’® | å…³é—­ç•Œé¢è¿”å›å¤§å… |
| `OnSliderChange(float val)` | è¿›åº¦æ¡æ‹–åŠ¨ | æ›´æ–°é®ç½©ä½ç½® |
| `OnGetItemByIndex()` | åˆ—è¡¨é¡¹åˆ›å»º | è®¾ç½®ç›˜å­ä½ç½® |
| `OnClickLvUp()` | ç‚¹å‡»å‡çº§æŒ‰é’® | å‡çº§é¤å…ç­‰çº§ |
| `OnClickUnlockAuto()` | ç‚¹å‡»è‡ªåŠ¨è§£é”æŒ‰é’® | è§£é”è‡ªåŠ¨æ´—ç¢—åŠŸèƒ½ |

---

## ğŸ”„ æµç¨‹å›¾

```mermaid
flowchart TD
    A[ç•Œé¢å¯ç”¨ OnEnable] --> B[åˆå§‹åŒ–æ•°æ®]
    B --> C[åˆ·æ–°ç›˜å­åˆ—è¡¨]
    C --> D[æ’­æ”¾æ‰“å¼€éŸ³æ•ˆ]
    D --> E[åˆ·æ–°ç­‰çº§ä¿¡æ¯]
    E --> F{è‡ªåŠ¨æ´—ç¢—ï¼Ÿ}
    F -->|æ˜¯ | G[å¯åŠ¨æ”¶ç›Šå®šæ—¶å™¨]
    F -->|å¦ | H[å¯åŠ¨æ‰‹åŠ¨æ¨¡å¼]
    G --> I[Update å¾ªç¯]
    H --> J[ç­‰å¾…ç‚¹å‡»]
    I --> K[æ›´æ–°æ”¶ç›Šè¿›åº¦]
    K --> L{ç‚¹å‡»ç›˜å­ï¼Ÿ}
    L -->|æ˜¯ | M[æ’­æ”¾æ´—ç¢—åŠ¨ç”»]
    L -->|å¦ | I
    M --> N[å¢åŠ æ”¶ç›Š]
    N --> I
    J --> O{ç‚¹å‡»åŠ ç›˜å­ï¼Ÿ}
    O -->|æ˜¯ | P[æ’­æ”¾å¹¿å‘Š]
    O -->|å¦ | Q{ç‚¹å‡»å‡çº§ï¼Ÿ}
    P --> R[é‡ç½®å†·å´]
    Q --> S[å‡çº§é¤å…]
```

---

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### æ‰“å¼€æ´—ç¢—ç•Œé¢

```csharp
// ä»å¤§å…æ‰“å¼€æ´—ç¢—ç•Œé¢
public void OnClickBtnRestaurant()
{
    OnClickBtnRestaurantAsync().Coroutine();
}

private async ETTask OnClickBtnRestaurantAsync()
{
    using ListComponent<ETTask> task = ListComponent<ETTask>.Create();
    task.Add(GameObjectPoolManager.GetInstance().PreLoadGameObjectAsync(UIWashDishView.PrefabPath, 0));
    task.Add(Move2Building("Restaurant"));
    await ETTaskHelper.WaitAll(task);
    UIManager.Instance.OpenWindow<UIWashDishView>(UIWashDishView.PrefabPath).Coroutine();
}
```

### åˆ·æ–°æ”¶ç›Šæ˜¾ç¤º

```csharp
// å½“æ”¶ç›Šå˜åŒ–æ—¶åˆ·æ–°ç•Œé¢
var washView = UIManager.Instance.GetView<UIWashDishView>(1);
washView?.UpdateImmediate();
```

### æ´—ç¢—æ“ä½œ

```csharp
// ç‚¹å‡»ç›˜å­æ—¶
public void OnClickDish()
{
    if (isAnim) return; // åŠ¨ç”»ä¸­ç¦æ­¢æ“ä½œ
    
    ShockManager.Instance.Vibrate(); // éœ‡åŠ¨åé¦ˆ
    
    if (step % 2 == 0)
    {
        WashDish(index).Coroutine(); // å¶æ•°æ­¥æ´—ç¢—
    }
    else
    {
        RemoveDish(index).Coroutine(); // å¥‡æ•°æ­¥ç§»é™¤
    }
    step++;
}
```

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [UILobbyView.cs.md](./UILobbyView.cs.md) - å¤§å…ä¸»ç•Œé¢
- [UIProfitWin.cs.md](./UIProfitWin.cs.md) - é¤å…æ”¶ç›Šçª—å£
- [RestaurantConfig.cs.md](../../../Config/RestaurantConfig.cs.md) - é¤å…é…ç½®
- [PlayerDataManager.cs.md](../../Data/PlayerDataManager.cs.md) - ç©å®¶æ•°æ®ç®¡ç†å™¨
- [AdManager.cs.md](../../../Manager/AdManager.cs.md) - å¹¿å‘Šç®¡ç†å™¨

---

*æœ€åæ›´æ–°ï¼š2026-03-02*
